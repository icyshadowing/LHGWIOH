<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LGWIOH Quiz</title>
<style>
body { font-family: Arial,sans-serif; background:#f7f8fb; margin:0; padding:20px; color:#111; }
h1,h2{margin:0 0 12px 0;}
.container { max-width:700px; margin:auto; }
.card { background:#fff; padding:16px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.08); margin-bottom:16px; }
select,input,textarea,button{width:100%; padding:10px; margin:6px 0; border-radius:8px; border:1px solid #ccc; font-size:15px; }
textarea{min-height:80px; resize:vertical;}
button{background:#2563eb;color:#fff;font-weight:600;border:none;cursor:pointer;}
button.ghost{background:transparent;color:#2563eb;border:1px solid rgba(37,99,235,0.3);}
.user-verse .word{display:inline-block;margin:0 2px;padding:2px 4px;border-radius:4px;}
.ok{color:#000;}
.spelling,.extra{color:#0b66ff;}
.missing{color:#ff2e2e;}
.muted{color:#555;font-size:13px;}
</style>
</head>
<body>
<div class="container">
<h1>LGWIOH Quiz</h1>

<div id="packSelectCard" class="card">
  <h2>Select a Pack</h2>
  <select id="packSelect"></select>
  <button id="startQuizBtn">Start Quiz</button>
</div>

<div id="quizCard" class="card" style="display:none;">
  <h2 id="quizRef"></h2>
  <label>Title</label>
  <input id="inputTitle">
  <label>Verse</label>
  <textarea id="inputVerse"></textarea>
  <button id="submitAnswerBtn">Submit</button>
  <button id="skipBtn" class="ghost">Show Answer</button>
</div>

<div id="reviewCard" class="card" style="display:none;">
  <h2>Review</h2>
  <div><strong>Correct:</strong> <span id="correctTitle"></span></div>
  <div id="correctVerse" class="muted"></div>
  <div><strong>Your Input:</strong> <span id="userTitle"></span></div>
  <div class="user-verse" id="userVerseBox"></div>
  <button id="nextBtn">Next</button>
  <button id="retryBtn" class="ghost">Try Again</button>
  <div class="muted" style="margin-top:6px;">Black=correct, Blue=wrong/spelling/extra, Red=missing</div>
</div>
</div>

<script>
// Preloaded verse packs
const VERSE_PACKS = {
  "Assurances":[
    {title:"Assurance Of Salvation",ref:"1 John 5:11-12",verse:"And this is the testimony: God has given us eternal life, and this life is in his Son. He who has the Son has life; he who does not have the Son of God does not have life."},
    {title:"Assurance Of Answered Prayer",ref:"John 16:24",verse:"Until now you have not asked for anything in my name. Ask and you will receive, and your joy will be complete."}
  ],
  "Faith":[
    {title:"Faith Over Fear",ref:"2 Timothy 1:7",verse:"For God has not given us a spirit of fear, but of power, love, and a sound mind."},
    {title:"Faith Brings Healing",ref:"James 5:15",verse:"And the prayer of faith will save the sick, and the Lord will raise him up."}
  ],
  "Encouragement":[
    {title:"God's Strength",ref:"Isaiah 40:31",verse:"But those who wait on the Lord shall renew their strength; they shall mount up with wings like eagles, they shall run and not be weary, they shall walk and not faint."},
    {title:"Peace In Trials",ref:"Philippians 4:7",verse:"And the peace of God, which surpasses all understanding, will guard your hearts and minds in Christ Jesus."}
  ]
};

// Elements
const packSelect = document.getElementById('packSelect');
const startQuizBtn = document.getElementById('startQuizBtn');
const quizCard = document.getElementById('quizCard');
const quizRef = document.getElementById('quizRef');
const inputTitle = document.getElementById('inputTitle');
const inputVerse = document.getElementById('inputVerse');
const submitAnswerBtn = document.getElementById('submitAnswerBtn');
const skipBtn = document.getElementById('skipBtn');
const reviewCard = document.getElementById('reviewCard');
const correctTitle = document.getElementById('correctTitle');
const correctVerse = document.getElementById('correctVerse');
const userTitleEl = document.getElementById('userTitle');
const userVerseBox = document.getElementById('userVerseBox');
const nextBtn = document.getElementById('nextBtn');
const retryBtn = document.getElementById('retryBtn');

// Initialize
let session = null;

// Populate pack select
for(let packName in VERSE_PACKS){
  const opt = document.createElement('option'); opt.value=packName; opt.textContent=packName; packSelect.appendChild(opt);
}

// Quiz functions
startQuizBtn.onclick = () => {
  const packName = packSelect.value;
  const pack = VERSE_PACKS[packName];
  session = {pack, remaining:shuffle(pack.slice()), current:null};
  document.getElementById('packSelectCard').style.display='none';
  reviewCard.style.display='none';
  quizCard.style.display='block';
  renderNext();
};

function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}

function renderNext(){
  if(session.remaining.length===0){
    quizCard.innerHTML="<h2>Quiz Complete!</h2>";
    return;
  }
  session.current = session.remaining.pop();
  quizRef.textContent = session.current.ref;
  inputTitle.value = "";
  inputVerse.value = "";
}

submitAnswerBtn.onclick = ()=> showReview(inputTitle.value.trim(),inputVerse.value.trim());
skipBtn.onclick = ()=> showReview("","");

function showReview(uTitle,uVerse){
  quizCard.style.display='none';
  reviewCard.style.display='block';
  const c = session.current;
  correctTitle.textContent = c.title;
  correctVerse.textContent = c.verse;
  userTitleEl.textContent = uTitle || "â€”";

  userVerseBox.innerHTML = "";
  highlightComparison(c.verse,uVerse).forEach(p=>{
    if(p.type==='missing'){ const s=document.createElement('span'); s.className='word missing'; s.textContent=p.text; userVerseBox.appendChild(s);}
    else { p.words.forEach(w=>{ const sp=document.createElement('span'); sp.className='word '+p.type; sp.textContent=w; userVerseBox.appendChild(sp); });}
  });
}

nextBtn.onclick = ()=>{ reviewCard.style.display='none'; quizCard.style.display='block'; renderNext(); }
retryBtn.onclick = ()=>{ session.remaining.push(session.current); reviewCard.style.display='none'; quizCard.style.display='block'; renderNext(); }

// Diff helpers
function tokenize(s){return s? s.trim().split(/\s+/):[];}
function normalize(w){return w.replace(/[\W_]+/g,'').toLowerCase();}
function levenshtein(a,b){const n=a.length,m=b.length;if(!n)return m;if(!m)return n;const dp=Array.from({length:n+1},()=>Array(m+1).fill(0));for(let i=0;i<=n;i++)dp[i][0]=i;for(let j=0;j<=m;j++)dp[0][j]=j;for(let i=1;i<=n;i++){for(let j=1;j<=m;j++){const cost=a[i-1]===b[j-1]?0:1;dp[i][j]=Math.min(dp[i-1][j]+1,dp[i][j-1]+1,dp[i-1][j-1]+cost);}}return dp[n][m];}
function alignWords(cw,uw){const n=cw.length,m=uw.length,dp=Array.from({length:n+1},()=>Array(m+1).fill(0));for(let i=1;i<=n;i++)for(let j=1;j<=m;j++)dp[i][j]=normalize(cw[i-1])===normalize(uw[j-1])?dp[i-1][j-1]+1:Math.max(dp[i-1][j],dp[i][j-1]);const aligned=[];let i=n,j=m;while(i>0&&j>0){if(normalize(cw[i-1])===normalize(uw[j-1])){aligned.unshift({c:cw[i-1],u:uw[j-1]});i--;j--;}else if(dp[i-1][j]>=dp[i][j-1]){aligned.unshift({c:cw[i-1],u:null});i--;}else{aligned.unshift({c:null,u:uw[j-1]});j--;}}while(i>0){aligned.unshift({c:cw[i-1],u:null});i--;}while(j>0){aligned.unshift({c:null,u:uw[j-1]});j--;}return aligned;}
function highlightComparison(correct,user){const cw=tokenize(correct),uw=tokenize(user),aligned=alignWords(cw,uw),parts=[],pushBuf=()=>{if(buf.type)parts.push(buf);};let buf={type:null,words:[]};aligned.forEach(a=>{if(!a.u){parts.push({type:'missing',text:a.c});}else if(!a.c){if(buf.type==='extra')buf.words.push(a.u);else{pushBuf();buf={type:'extra',words:[a.u]};}}else if(normalize(a.c)===normalize(a.u)){if(buf.type==='ok')buf.words.push(a.u);else{pushBuf();buf={type:'ok',words:[a.u]};}}else{const d=levenshtein(normalize(a.c),normalize(a.u));const t=Math.max(1,Math.floor(normalize(a.c).length/3));if(d<=t){if(buf.type==='spelling')buf.words.push(a.u);else{pushBuf();buf={type:'spelling',words:[a.u]};}}else{if(buf.type==='extra')buf.words.push(a.u);else{pushBuf();buf={type:'extra',words:[a.u]};}}}});pushBuf();return parts;}
</script>
